#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

// Define the structure for adjacency list node
struct AdjNode {
    int dest;
    struct AdjNode* next;
};

// Define the structure for a graph
struct Graph {
    int V;                // Number of vertices
    struct AdjNode** array; // Array of adjacency lists
};

// Function to create a new adjacency list node
struct AdjNode* createAdjNode(int dest) {
    struct AdjNode* newNode = (struct AdjNode*)malloc(sizeof(struct AdjNode));
    newNode->dest = dest;
    newNode->next = NULL;
    return newNode;
}

// Function to create a graph with V vertices
struct Graph* createGraph(int V) {
    struct Graph* graph = (struct Graph*)malloc(sizeof(struct Graph));
    graph->V = V;

    // Create an array of adjacency lists
    graph->array = (struct AdjNode**)malloc(V * sizeof(struct AdjNode*));
    for (int i = 0; i < V; i++)
        graph->array[i] = NULL;

    return graph;
}

// Add an edge to an undirected graph
void addEdge(struct Graph* graph, int src, int dest) {
    // Add edge from src to dest
    struct AdjNode* newNode = createAdjNode(dest);
    newNode->next = graph->array[src];
    graph->array[src] = newNode;

    // For undirected graph, add edge from dest to src
    newNode = createAdjNode(src);
    newNode->next = graph->array[dest];
    graph->array[dest] = newNode;
}

// Queue structure for BFS
struct Queue {
    int* items;
    int front;
    int rear;
    int maxSize;
};

// Create a queue
struct Queue* createQueue(int size) {
    struct Queue* q = (struct Queue*)malloc(sizeof(struct Queue));
    q->items = (int*)malloc(size * sizeof(int));
    q->front = 0;
    q->rear = -1;
    q->maxSize = size;
    return q;
}

// Check if queue is empty
bool isEmpty(struct Queue* q) {
    return q->rear < q->front;
}

// Enqueue
void enqueue(struct Queue* q, int value) {
    if (q->rear < q->maxSize - 1) {
        q->rear++;
        q->items[q->rear] = value;
    }
}

// Dequeue
int dequeue(struct Queue* q) {
    if (!isEmpty(q)) {
        return q->items[q->front++];
    }
    return -1; // Queue empty
}

// BFS traversal from a given source vertex
void BFS(struct Graph* graph, int start) {
    bool* visited = (bool*)malloc(graph->V * sizeof(bool));
    for (int i = 0; i < graph->V; i++)
        visited[i] = false;

    struct Queue* queue = createQueue(graph->V);

    visited[start] = true;
    enqueue(queue, start);

    printf("BFS traversal starting from vertex %d: ", start);

    while (!isEmpty(queue)) {
        int current = dequeue(queue);
        printf("%d ", current);

        // Visit all adjacent vertices
        struct AdjNode* temp = graph->array[current];
        while (temp != NULL) {
            if (!visited[temp->dest]) {
                visited[temp->dest] = true;
                enqueue(queue, temp->dest);
            }
            temp = temp->next;
        }
    }
    printf("\n");
    free(visited);
}

int main() {
    int V = 5;
    struct Graph* graph = createGraph(V);

    addEdge(graph, 0, 1);
    addEdge(graph, 0, 2);
    addEdge(graph, 1, 2);
    addEdge(graph, 1, 3);
    addEdge(graph, 2, 4);

    BFS(graph, 0);

    return 0;
}
